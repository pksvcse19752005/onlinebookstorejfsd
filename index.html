<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BookVerse | Online Book Store</title>
  <link rel="icon" type="image/svg+xml" href="https://img.icons8.com/color/96/000000/book-stack.png"/>

  <style>
    :root {
      --main-gradient: linear-gradient(135deg, #7f53ac 0%, #647dee 100%);
      --glass-bg: rgba(255,255,255,0.2);
      --glass-blur: blur(12px);
      --accent: #7f53ac;
      --danger: #ff5858;
      --shadow: 0 6px 32px rgba(80,80,120,0.15);
      --border-glass: 1.5px solid rgba(120,120,255,0.18);
      --dark-bg: #21223e;
      --light-bg: #f8f9fc;
      --text: #23224c;
      --text-invert: #f4f6fa;
      --green: #2cc785;
      --yellow: #ffd866;
    }
    [data-theme="dark"] {
      --main-gradient: linear-gradient(135deg, #23224c 0%, #404379 100%);
      --glass-bg: rgba(40,44,70, 0.42);
      --text: #f4f6fa;
      --text-invert: #23224c;
      --light-bg: #26294e;
      --dark-bg: #181933;
    }
    *, *:before, *:after { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', 'Poppins', Arial, sans-serif;
      background: var(--main-gradient), var(--light-bg);
      min-height: 100vh;
      color: var(--text);
      transition: background .5s, color .5s;
    }
    a { color: inherit; text-decoration: none; }
    #app-container {
      max-width: 1100px;
      margin: auto;
      padding: 1rem;
    }
    /* Navbar */
    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--glass-bg);
      box-shadow: var(--shadow);
      border-radius: 2rem;
      padding: .7rem 2rem;
      margin: 1.2rem 0 2.5rem 0;
      backdrop-filter: var(--glass-blur);
      border: var(--border-glass);
      z-index: 100;
      position: relative;
    }
    .navbar .logo {
      display: flex; align-items: center; font-size: 1.6rem; font-weight: 600; letter-spacing: .5px;
    }
    .navbar .logo img {
      width: 36px; margin-right: 0.4rem; border-radius: 8px;
    }
    .navbar-search { flex: 1; margin: 0 1.5rem; }
    .navbar-search input {
      width: 100%; padding: .5rem 1.2rem; border-radius: 1rem;
      border: none; outline: none; background: var(--light-bg); font-size: 1rem;
      box-shadow: 0 3px 16px rgba(60,60,120,0.07);
      transition: background .4s;
    }
    .navbar-menu {
      display: flex; gap: 2.2rem; align-items: center; font-weight: 500;
    }
    .navbar-item {
      cursor: pointer; position: relative; padding: .25rem .1rem;
    }
    .navbar-item:hover::after {
      content: "";
      display: block; height: 2px; width: 100%;
      background: var(--accent); border-radius: 2px;
    }
    .cart-icon {
      position: relative; font-size: 1.4rem; margin-left: 1rem; cursor: pointer;
    }
    .cart-badge {
      position: absolute; top: -8px; right: -8px;
      background: var(--danger); color: white; font-size: .9rem; font-weight: bold;
      border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;
    }
    .theme-toggle {
      margin-left: 1.4rem; background: none; border: none; font-size: 1.3rem; cursor: pointer;
      transition: transform .4s;
    }
    .theme-toggle:hover { transform: rotate(18deg) scale(1.13); }
    .mobile-menu-btn { display: none; }

    /* ---- Hero Section */
    .hero {
      margin: 1.7rem 0 2.9rem 0;
      background: var(--glass-bg);
      box-shadow: var(--shadow);
      border-radius: 2.7rem;
      padding: 3rem 3.5vw 2rem 3.5vw;
      display: flex; flex-direction: column; align-items: center;
      position: relative;
      overflow: hidden;
      border: var(--border-glass);
      min-height: 320px;
    }
    .hero-ann {
      font-size: 1rem; font-style: italic; color: var(--accent); margin-bottom: 1rem;
    }
    .hero-title {
      font-size: 2.7rem;
      font-weight: 700;
      background: linear-gradient(92deg, var(--accent), #86a8e7, var(--yellow));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: bounceTagline 4s infinite alternate;
    }
    @keyframes bounceTagline {
      0%,100% { letter-spacing: 2px; }
      50% { letter-spacing: 7px; }
    }
    .hero-btn {
      margin-top: 2.2rem;
      font-size: 1.09rem; font-weight: 600;
      padding: .9rem 2.3rem;
      background: linear-gradient(98deg, var(--accent), #86a8e7, var(--yellow));
      border: none; border-radius: 2.3rem;
      color: #fff; box-shadow: 0 3px 16px rgba(80,90,140,.16);
      cursor: pointer; transition: transform .2s, background .39s;
    }
    .hero-btn:hover {
      background: linear-gradient(98deg, var(--yellow), #86a8e7, var(--accent));
      transform: scale(1.09) translateY(-4px);
      letter-spacing: 1.5px;
    }

    /* ---- Category Filter */
    .categories {
      display: flex; justify-content: center; gap: 1rem;
      margin: 2.1rem 0 1.1rem 0;
      flex-wrap: wrap;
    }
    .cat-btn {
      padding: .5rem 1.5rem;
      border: none;
      border-radius: 1.1rem;
      background: var(--glass-bg);
      color: var(--accent);
      font-weight: 600; font-size: 1rem;
      box-shadow: var(--shadow);
      cursor: pointer;
      outline: none;
      transition: background .3s, color .2s, transform .2s;
      border: var(--border-glass);
    }
    .cat-btn.active, .cat-btn:hover {
      background: var(--main-gradient);
      color: #fff;
      transform: scale(1.09) translateY(-2px);
    }

    /* ---- Book Gallery */
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1.6rem;
      margin-bottom: 2.7rem;
    }
    .book-card {
      background: var(--glass-bg);
      box-shadow: var(--shadow);
      border-radius: 1.8rem;
      padding: 1.1rem 1.1rem .7rem 1.1rem;
      display: flex; flex-direction: column; align-items: center;
      transition: transform .19s, box-shadow .19s;
      position: relative;
      border: var(--border-glass);
      overflow: hidden;
    }
    .book-card:hover, .book-card:focus-within {
      transform: translateY(-12px) scale(1.036);
      box-shadow: 0 14px 48px rgba(100,60,160,0.13);
    }
    .book-cover {
      width: 110px; height: 157px; object-fit: cover;
      border-radius: 1rem;
      margin-bottom: 0.9rem;
      box-shadow: 0 4px 18px rgba(90,90,130,.11);
      background: #f4f4fb;
    }
    .book-title { font-weight: bold; font-size: 1.07rem; text-align: center; }
    .book-author { color: var(--accent); font-size: .97rem; margin-bottom: .25rem; }
    .book-meta { display: flex; gap: 1rem; font-size: .97rem; margin: .2rem 0 .8rem 0; }
    .book-rating {
      color: #fdba29; font-weight: bold;
      font-size: 1rem;
      margin-right: 6px;
    }
    .book-price { font-weight: 600; color: var(--green); }
    .add-cart-btn {
      padding: .49rem 1.3rem; border:none;
      border-radius: 1rem; background: var(--accent);
      color: #fff; font-weight: 600; font-size: 1rem; cursor: pointer;
      box-shadow: 0 2px 10px rgba(90,90,150,0.09);
      margin-bottom: .2rem; transition: background .16s;
    }
    .add-cart-btn:active { background: #515187; }
    .view-details {
      position: absolute; bottom: 15px; left: 0; right: 0;
      text-align: center; opacity: 0; transition: opacity .19s;
      color: var(--accent); font-weight: bold; font-size: .98rem; pointer-events: none;
    }
    .book-card:hover .view-details { opacity: 1; }
    /* Book Card Overlay Buttons */
    .book-actions {
      display: flex; gap: .5rem; margin-top: .7rem;
      width: 100%; justify-content: center; flex-wrap: wrap;
    }
    .small-btn {
      font-size: .95rem; background: var(--glass-bg); color: var(--accent);
      border: var(--border-glass); border-radius: 0.9rem;
      cursor: pointer; padding: .3rem .95rem; margin: 0 .09rem;
      transition: background .16s, color .13s, transform .13s;
    }
    .small-btn:hover {
      background: var(--accent); color: #fff; transform: scale(1.06);
    }

    /* ---- Virtual Bookshelf Carousel ---- */
    .bookshelf-section {
      margin: 2.4rem 0 .7rem 0;
      text-align: center;
    }
    .bookshelf-title { font-size: 1.45rem; font-weight: 700; margin-bottom: .5rem; }
    .bookshelf-carousel {
      perspective: 700px;
      overflow-x: auto; min-height: 185px;
      display: flex; align-items: center; gap: 2.5rem;
      justify-content: center;
      padding: .9rem 0;
      border-radius: 2rem;
      background: var(--glass-bg);
      box-shadow: var(--shadow);
      margin-bottom: .6rem;
      scroll-snap-type: x mandatory;
    }
    .shelf-book-card {
      width: 130px; height: 175px;
      box-shadow: 0 6px 26px rgba(90,90,150,0.09);
      border-radius: 1.2rem;
      background: var(--main-gradient);
      color: #fff;
      display: flex; flex-direction: column; align-items: center;
      transform: rotateY(-12deg); transition: transform .4s, box-shadow .3s;
      position: relative; z-index: 1;
      scroll-snap-align: center;
      margin-bottom: .7rem;
    }
    .shelf-book-card:hover { transform: rotateY(0deg) scale(1.09) translateY(-6px);}
    .shelf-cover {
      width: 80px; height: 110px; object-fit: cover; border-radius: .6rem;
      margin-top: 1rem; margin-bottom: .5rem; background: #fff;
      box-shadow: 0 2px 12px rgba(70,70,110,0.1);
    }
    .shelf-title {
      font-size: 1rem; font-weight: 600; text-align: center;
      margin-bottom: .3rem;
    }

    /* ---- Reading Progress Bar ---- */
    .progress-bar-ct {
      background: #e7e8fb; border-radius: .59rem; overflow: hidden;
      margin: .4rem 0; width: 97%; height: 10px;
      box-shadow: 0 1px 7px rgba(110,110,210,0.07);
      border: 1.2px solid #c9d8fd;
    }
    .progress-bar {
      height: 10px;
      background: linear-gradient(97deg, var(--accent), #fdba29);
      width: 0; border-radius: .4rem; transition: width .85s cubic-bezier(.7,.1,.24,1.04);
    }

    /* ---- Quote Collector ---- */
    .quotes-section {
      margin: 2.2rem 0 1.4rem 0;
      background: var(--glass-bg);
      border-radius: 2rem;
      box-shadow: var(--shadow);
      border: var(--border-glass);
      padding: 1.6rem 2vw .8rem 2vw;
    }
    .quotes-title {
      font-size: 1.13rem;
      font-weight: 600;
      color: var(--accent);
      letter-spacing: 1.2px;
      margin-bottom: .9rem;
    }
    .quotes-list {
      margin: 0; padding: 0; list-style: none;
      font-size: .97rem; color: var(--text);
    }
    .quotes-list li {
      border-left: 3px solid var(--accent);
      margin-bottom: .7rem;
      padding-left: .9rem;
      font-style: italic;
    }

    /* ---- Book Swap ---- */
    .swap-section {
      margin: 2.5rem 0 .7rem 0;
      background: var(--glass-bg); box-shadow: var(--shadow);
      border-radius: 2rem;
      padding: 1.3rem .9vw 1.4rem .9vw;
      border: var(--border-glass);
      text-align: center;
    }
    .swap-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: .7rem;
    }
    .swap-list { margin: 0 auto 1.1rem auto; padding: 0; max-width: 496px; }
    .swap-list li {
      background: var(--light-bg);
      color: var(--accent);
      font-weight: 600;
      box-shadow: 0 2px 10px rgba(110,50,150,0.07);
      border-radius: 1.1rem;
      padding: .7rem 1.1rem; margin-bottom: .9rem;
      display: flex; justify-content: space-between; align-items: center;
    }
    .swap-list .swap-user {
      font-size: .98rem; color: #666; font-weight: 400;
      margin-left: 1.5rem;
    }
    .swap-add-form input, .swap-add-form textarea {
      display: block; margin: .4rem auto 1.1rem auto; width: 85%; max-width: 360px;
      padding: .47rem .7rem; border-radius: 1rem;
      font-size: 1rem; border: 1.2px solid var(--accent); background: var(--light-bg); color: var(--text);
      box-shadow: 0 3px 16px rgba(60,60,120,0.06);
      outline: none;
    }
    .swap-add-form button {
      background: var(--main-gradient);
      color: #fff; font-weight: bold;
      border: none; border-radius: 1.1rem;
      padding: .61rem 2.29rem; font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(110,60,190,0.07);
      transition: background .22s, box-shadow .23s;
    }
    .swap-add-form button:hover {
      background: linear-gradient(92deg, #ffc371, #647dee);
      box-shadow: 0 7px 20px rgba(200,200,100,.13);
    }

    /* ---- Cart Panel ---- */
    .cart-panel {
      position: fixed; top: 0; right: -420px; width: 390px; max-width: 97vw;
      height: 100vh; background: var(--glass-bg);
      box-shadow: -16px 0 64px rgba(110,110,180,0.12);
      z-index: 999;
      padding: 2.2rem 1.5rem;
      border-radius: 1.7rem 0 0 1.7rem;
      border-left: var(--border-glass);
      transition: right .38s cubic-bezier(.7,.1,.2,.95);
      overflow-y: auto;
      backdrop-filter: var(--glass-blur);
      display: flex; flex-direction: column;
    }
    .cart-panel.open { right: 0; }
    .cart-title {
      font-weight: bold; font-size: 1.3rem;
    }
    .cart-close {
      position: absolute; top: 1.9rem; right: 1.6rem; font-size: 1.44rem;
      color: var(--accent); background: none; border: none; cursor: pointer;
    }
    .cart-items {
      margin: 2.1rem 0 1.29rem 0; flex: 1 1;
    }
    .cart-item {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 1.1rem;
      padding-bottom: .5rem;
      border-bottom: 1.2px solid rgba(100,100,180,0.08);
    }
    .cart-item img {
      width: 48px; height: 56px; border-radius: .49rem; margin-right: .8rem; object-fit: cover;
      background: #dbeafc;
    }
    .cart-item-details {
      flex: 1 1;
      font-size: .99rem;
    }
    .cart-item-actions {
      display: flex; flex-direction: column; gap: .35rem; align-items: flex-end;
    }
    .cart-item-qty {
      background: var(--accent); color: #fff; padding: .09rem .7rem; font-weight: bold;
      border-radius: .8rem; margin-bottom: .17rem; font-size: .96rem; display:inline-block;
    }
    .cart-item-remove {
      color: var(--danger); background: none; border: none; font-size: 1.2rem;
      cursor: pointer; transition: color .15s;
    }
    .cart-item-remove:hover { color: #ff6969; }
    .cart-total-row {
      display: flex; align-items: center; justify-content: space-between;
      font-size: 1.12rem; font-weight: bold; margin-top: 1.1rem;
    }
    .cart-checkout-btn {
      width: 100%; padding: 1rem; border: none;
      border-radius: 1.1rem; background: var(--main-gradient);
      box-shadow: 0 2px 10px rgba(100,140,210,0.08);
      color: #fff; font-weight: 700; font-size: 1.1rem; cursor: pointer;
      margin-top: 2rem;
      transition: background .17s;
    }
    .cart-checkout-btn:hover { background: linear-gradient(91deg, #ffc371, #647dee);}
    /* Checkout Form */
    .checkout-form input, .checkout-form select {
      width: 100%; padding: .7rem 1rem; border-radius: .97rem;
      margin-bottom: .83rem; font-size: 1rem;
      border: 1.2px solid #b5a9e8;
      background: var(--light-bg);
      transition: border .16s;
    }
    .checkout-form input:focus { border-color: var(--accent);}
    .checkout-success {
      text-align: center; padding: 1.9rem 1rem; font-size: 1.2rem; font-weight: bold; color: var(--green);
    }

    /* --- Modal --- */
    .modal {
      display: none;
      position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
      background: rgba(90,94,185,0.13);
      align-items: center; justify-content: center;
      backdrop-filter: blur(2px);
    }
    .modal.open { display: flex; }
    .modal-content {
      background: var(--glass-bg);
      border-radius: 1.9rem;
      box-shadow: var(--shadow);
      padding: 2.7rem 3.2vw;
      font-size: 1.17rem;
      color: var(--accent);
      font-weight: 600;
      animation: popIn .5s;
      border: var(--border-glass);
      position: relative;
    }
    @keyframes popIn {
      0% { transform: scale(0.7); opacity: 0;}
      100% { transform: scale(1); opacity: 1;}
    }
    .modal-close {
      position: absolute; top: 1.4rem; right: 1.8rem; font-size: 1.6rem; cursor: pointer; background: none; border: none; color: var(--danger);
    }
    /* --- Profile --- */
    .profile-section {
      margin: 2.7rem 0 2.1rem 0; background: var(--glass-bg);
      border-radius: 2rem; box-shadow: var(--shadow);
      padding: 1.8rem 2vw 1.6rem 2vw;
      border: var(--border-glass);
      max-width: 610px;
      margin-left: auto; margin-right: auto;
    }
    .profile-header {
      display: flex; justify-content: space-between; align-items: center;
    }
    .profile-username { font-size: 1.33rem; font-weight: bold; }
    .profile-edit-btn {
      background: var(--accent); color: #fff;
      border: none; border-radius: 1.1rem; font-size: .97rem;
      padding: .43rem 1.2rem; cursor: pointer; transition: background .15s;
    }
    .profile-edit-btn:hover { background: var(--green);}
    .profile-subtitle { font-size: 1.07rem; margin-top: .43rem; color: var(--accent);}
    .profile-books, .profile-quotes, .profile-reading {
      margin: 1.2rem 0;
    }
    .profile-books img {
      width: 33px; height: 45px; margin-right: .4rem; border-radius: .25rem; background: #e9e8fc;
    }
    /* Footer */
    footer {
      text-align: center; padding: 2rem 2vw 2.7rem 2vw;
      background: var(--glass-bg);
      border-radius: 2rem 2rem 0 0;
      box-shadow: var(--shadow);
      color: #626183;
      margin-top: 4.4rem;
      font-size: 1.00rem;
      border-top: var(--border-glass);
    }
    .footer-links {
      margin-bottom: 0.6rem;
    }
    .footer-link { margin: 0 .7rem; color: #8f94fb; font-weight: 500; }
    .footer-link:hover { color: var(--accent);}
    .footer-social a {
      margin: 0 .38rem; color: #6a6da8; font-size: 1.4rem;
      transition: color .17s;}
    .footer-social a:hover { color: var(--accent);}
    /* --- Responsive --- */
    @media (max-width: 900px) {
      .navbar, .hero, .profile-section, .swap-section, .bookshelf-section, .quotes-section, footer {
        border-radius: 1rem;
        padding-left: 1.7vw; padding-right: 1.7vw;
      }
    }
    @media (max-width: 700px) {
      .navbar-menu { gap: 1.1rem; }
      .hero { font-size: .77rem; padding: 1.1rem 2vw; }
      .profile-section { padding: .7rem 2.5vw; }
      .swap-section { font-size: .96rem; }
      .book-card { padding: .67rem; }
    }
    @media (max-width: 640px) {
      .navbar { padding: .6rem .8rem; }
      .profile-section { font-size: .96rem;}
    }
    @media (max-width: 520px) {
      .navbar { flex-direction: column; gap: .7rem;}
      .hero-title { font-size: 2.1rem; }
      .categories { gap: .6rem;}
      .gallery { gap: .8rem; }
      .footer-link { margin: 0 .19rem;}
      footer { font-size: .92rem; padding: 1.5rem .2vw; }
      .navbar-search input { font-size: .87rem;}
      .mobile-menu-btn { display: initial; }
      .navbar-menu { display: none; flex-direction: column; gap: .7rem; padding: .9rem 0;}
      .navbar-menu.open { display: flex;}
    }
  </style>
</head>

<body>
  <div id="app-container">
    <!-- Navbar -->
    <nav class="navbar">
      <span class="logo">
        <img src="https://img.icons8.com/color/48/null/book-stack.png" alt="" /> BookVerse
      </span>
      <span class="navbar-search">
        <input id="searchInput" type="text" placeholder="Search books or authors..." />
      </span>
      <button class="mobile-menu-btn" aria-label="show menu" onclick="toggleMobileMenu()">
        <span>&#9776;</span>
      </button>
      <div class="navbar-menu" id="navbarMenu">
        <span class="navbar-item" onclick="showSection('home')">Home</span>
        <span class="navbar-item" onclick="showSection('categories')">Categories</span>
        <span class="navbar-item" onclick="showCart()">Cart
          <span class="cart-icon">
            <span>&#128722;</span>
            <span class="cart-badge" id="cartBadge">0</span>
          </span>
        </span>
        <span class="navbar-item" onclick="showSection('profile')">Profile</span>
        <button class="theme-toggle" id="themeToggle" title="Toggle theme">&#9788;</button>
      </div>
    </nav>

    <!-- Hero Section -->
    <section id="heroSection" class="hero">
      <div class="hero-ann" style="letter-spacing: 2.1px;">Welcome to BookVerse</div>
      <div class="hero-title" id="animatedTagline"></div>
      <button class="hero-btn" onclick="scrollToGallery()">Shop Now</button>
    </section>

    <!-- Category Filter -->
    <section class="categories" id="categorySection">
      <button class="cat-btn active" onclick="filterCategory('All')">All</button>
      <button class="cat-btn" onclick="filterCategory('Fiction')">Fiction</button>
      <button class="cat-btn" onclick="filterCategory('Science')">Science</button>
      <button class="cat-btn" onclick="filterCategory('Kids')">Kids</button>
      <button class="cat-btn" onclick="filterCategory('Mystery')">Mystery</button>
      <button class="cat-btn" onclick="filterCategory('Self-Help')">Self-Help</button>
    </section>

    <!-- Book Gallery -->
    <section id="gallerySection" class="gallery"></section>

    <!-- Virtual Bookshelf -->
    <section class="bookshelf-section">
      <div class="bookshelf-title">ðŸ“š Your Virtual Bookshelf</div>
      <div class="bookshelf-carousel" id="bookshelfCarousel"></div>
    </section>

    <!-- Quote Collector -->
    <section class="quotes-section">
      <div class="quotes-title">ðŸ’¬ Saved Favorite Quotes</div>
      <ul class="quotes-list" id="quotesList"></ul>
    </section>

    <!-- Reading Progress -->
    <section style="margin-bottom:2.4rem;">
      <div class="bookshelf-title">ðŸ“– Reading Progress Tracker</div>
      <div id="progressList"></div>
    </section>

    <!-- Book Swap -->
    <section class="swap-section">
      <div class="swap-title">ðŸ”„ Book Swap Zone</div>
      <form class="swap-add-form" id="swapForm">
        <input type="text" id="swapBookTitle" placeholder="Book title to swap" required />
        <input type="text" id="swapUsername" placeholder="Your name (optional)" />
        <textarea id="swapDetails" rows="2" placeholder="Swap details or contact info (optional)"></textarea>
        <button type="submit">Post Swap Offer</button>
      </form>
      <ul class="swap-list" id="swapList"></ul>
    </section>

    <!-- Profile Section -->
    <section class="profile-section" id="profileSection" style="display:none;">
      <div class="profile-header">
        <span class="profile-username" id="profileUsername"></span>
        <button class="profile-edit-btn" onclick="editProfile()">Edit</button>
      </div>
      <div class="profile-subtitle">Your Purchased Books</div>
      <div class="profile-books" id="profileBooks"></div>
      <div class="profile-subtitle">Saved Quotes</div>
      <div class="profile-quotes" id="profileQuotes"></div>
      <div class="profile-subtitle">Reading Progress</div>
      <div class="profile-reading" id="profileReading"></div>
      <div style="margin-top:.8rem;">
        <button class="theme-toggle" onclick="toggleTheme()" style="font-size:1.2rem;">Switch Theme</button>
      </div>
    </section>

    <!-- Cart Panel -->
    <div class="cart-panel" id="cartPanel">
      <button class="cart-close" onclick="hideCart()">&times;</button>
      <div class="cart-title">ðŸ›’ Your Cart</div>
      <div class="cart-items" id="cartItems"></div>
      <div class="cart-total-row">
        <span>Total:</span>
        <span id="cartTotalPrice">â‚¹0</span>
      </div>
      <button class="cart-checkout-btn" onclick="showCheckout()">Checkout</button>
      <form id="checkoutForm" class="checkout-form" style="display:none;">
        <input type="text" id="checkoutName" placeholder="Your Name" required />
        <input type="text" id="checkoutAddress" placeholder="Shipping Address" required />
        <select id="checkoutPayment" required>
          <option value="">Payment Method</option>
          <option value="Cash">Cash on Delivery</option>
          <option value="UPI">UPI</option>
          <option value="Card">Credit/Debit Card</option>
        </select>
        <button type="submit" style="margin-top:.3rem;">Place Order</button>
      </form>
      <div class="checkout-success" id="checkoutSuccess" style="display:none;">
        ðŸŽ‰ Purchase Successful! Your books are on the way!
      </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
      <div class="modal-content" id="modalContent"></div>
      <button class="modal-close" onclick="closeModal()">&times;</button>
    </div>

    <!-- Confetti Canvas -->
    <canvas id="confetti" style="position:fixed;pointer-events:none;z-index:3000;inset:0;display:none;"></canvas>

    <!-- Footer -->
    <footer>
      <div class="footer-links">
        <a class="footer-link" href="#">About</a>
        <a class="footer-link" href="#">Contact</a>
        <a class="footer-link" href="#">Privacy Policy</a>
      </div>
      <div class="footer-social">
        <a href="#"><span>&#128241;</span></a>
        <a href="#"><span>&#128279;</span></a>
        <a href="#"><span>&#127891;</span></a>
        <a href="#"><span>&#128218;</span></a>
      </div>
      <div style="margin-top:1rem;opacity:.82;">
        &copy; 2025 BookVerse | Made with <span style="color:#e66465;">&#10084;</span> for booklovers.
      </div>
    </footer>
  </div>

<script>
// ------------------- App State --------------------
const API_BASE = ""; // If deployed to domain, set API base.
let BOOKS = []; // will hold all book objects
let filteredBooks = [];
let cart = JSON.parse(localStorage.getItem('cart') || "[]");
let username = localStorage.getItem("username") || "BookLover";
let bookshelf = JSON.parse(localStorage.getItem("bookshelf") || "[]");
let quotes = JSON.parse(localStorage.getItem("quotes") || "[]");
let progressTracker = JSON.parse(localStorage.getItem("progress") || "[]");

document.addEventListener("DOMContentLoaded", () => {
  applyTheme();
  fetchBooks();
  renderCart();
  renderBookshelf();
  renderQuotes();
  renderReadingProgress();
  renderProfile();
  fetchSwaps();
  animateTagline("Discover. Read. Repeat.");
  document.getElementById("searchInput").oninput = searchBooks;
  document.getElementById('swapForm').onsubmit = postSwap;
  window.addEventListener('resize', renderBookshelf);
});

// --------- THEME (Glassmorphism) ------------------
function toggleTheme() {
  let theme = document.documentElement.getAttribute("data-theme");
  if (theme === "dark") {
    document.documentElement.setAttribute("data-theme", "light");
    localStorage.setItem("theme", "light");
  } else {
    document.documentElement.setAttribute("data-theme", "dark");
    localStorage.setItem("theme", "dark");
  }
  applyTheme();
}
function applyTheme() {
  let theme = localStorage.getItem("theme") || "light";
  document.documentElement.setAttribute("data-theme", theme);
  document.getElementById("themeToggle").innerHTML = theme === "dark" ? "&#9790;" : "&#9788;";
}
// --------- NAVBAR / MOBILE  ----------------------
function toggleMobileMenu() {
  const menu = document.getElementById('navbarMenu');
  menu.classList.toggle('open');
}
function showSection(sec) {
  document.getElementById('profileSection').style.display = sec === 'profile' ? 'block' : 'none';
  document.getElementById('heroSection').style.display = "block";
  if (sec === 'home' || sec === 'categories') {
    scrollToTop();
  }
  if (sec === 'profile') {
    setTimeout(renderProfile, 100);
    document.getElementById('heroSection').style.display = "none";
  }
}
// --------- HERO TAGLINE ANIMATION ---------------
function animateTagline(txt) {
  let el = document.getElementById("animatedTagline");
  let idx = 0, dir = 1;
  function animate() {
    el.innerHTML = txt.substring(0, idx) + `<span style="opacity:.5;">${txt.substring(idx)}</span>`;
    if (dir === 1 && idx < txt.length) idx++;
    else if (dir === -1 && idx > 0) idx--;
    else dir *= -1;
    setTimeout(animate, dir === 1 ? 60 : 35);
  }
  animate();
}
// --------- SCROLLING ---------------
function scrollToGallery() {
  document.getElementById('gallerySection').scrollIntoView({ behavior: "smooth", block: "start" });
}
function scrollToTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
// --------- BOOK FETCH & RENDER ----------
function fetchBooks() {
  fetch('/books')
    .then(res => res.json())
    .then(data => {
      BOOKS = data;
      filteredBooks = BOOKS;
      renderBooks(BOOKS);
    });
}
function renderBooks(books) {
  const gallery = document.getElementById("gallerySection");
  if (!books.length) {
    gallery.innerHTML = "<div style='text-align:center;padding:2rem;'>No books available.</div>";
    return;
  }
  gallery.innerHTML = books.map(book => `
    <div class="book-card">
      <img class="book-cover" src="${book.image}" alt="${book.title}" loading="lazy"/>
      <div class="book-title">${book.title}</div>
      <div class="book-author">${book.author}</div>
      <div class="book-meta">
        <span class="book-rating">&#11088; ${book.rating}</span>
        <span class="book-price">â‚¹${book.price}</span>
      </div>
      <button class="add-cart-btn" onclick='addToCart(${book.id})'>Add to Cart</button>
      <div class="book-actions">
        <button class="small-btn" onclick='addToBookshelf(${book.id})'>Save to Shelf</button>
        <button class="small-btn" onclick='markReading(${book.id})'>Mark as Reading</button>
        <button class="small-btn" onclick="showQuoteModal(${book.id})">Add Favorite Quote</button>
      </div>
      <div class="view-details">View Details</div>
    </div>
  `).join("");
}

function filterCategory(genre) {
  document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
  [...document.querySelectorAll('.cat-btn')].find(b => b.innerText === genre || (genre === "All" && b.innerText==="All")).classList.add('active');
  filteredBooks = genre === "All" ? BOOKS : BOOKS.filter(b => b.genre === genre);
  renderBooks(filteredBooks);
}

// ------------ SEARCH ----------------
function searchBooks() {
  const q = (this.value || "").trim().toLowerCase();
  const result = filteredBooks.filter(book =>
    book.title.toLowerCase().includes(q) ||
    book.author.toLowerCase().includes(q)
  );
  renderBooks(result);
}

// --------- CART LOGIC ------------------
function addToCart(bookId) {
  const book = BOOKS.find(b => b.id === bookId);
  let idx = cart.findIndex(item => item.id === bookId);
  if (idx !== -1) {
    cart[idx].qty++;
  } else {
    cart.push({ ...book, qty: 1 });
  }
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
  showConfetti(17);
}
function renderCart() {
  document.getElementById("cartBadge").innerText = cart.reduce((a,b) => a+b.qty, 0);
  let panel = document.getElementById("cartItems");
  if (!cart.length) {
    panel.innerHTML = "<div style='padding:2rem;text-align:center;'>Your cart is empty.</div>";
    document.getElementById("cartTotalPrice").innerHTML = "â‚¹0";
    return;
  }
  panel.innerHTML = cart.map(item => `
    <div class="cart-item">
      <img src="${item.image}" />
      <div class="cart-item-details">
        <div>${item.title}</div>
        <div>by <span style="color:var(--accent)">${item.author}</span></div>
      </div>
      <div class="cart-item-actions">
        <span class="cart-item-qty">Ã—${item.qty}</span>
        <button class="cart-item-remove" onclick="removeFromCart(${item.id})">&times;</button>
      </div>
    </div>
  `).join("");
  document.getElementById("cartTotalPrice").innerHTML = "â‚¹" + cart.reduce((a, b) => a + b.price * b.qty, 0);
}
function removeFromCart(bookId) {
  cart = cart.filter(item => item.id !== bookId);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}
function showCart() {
  document.getElementById("cartPanel").classList.add('open');
  renderCart();
}
function hideCart() {
  document.getElementById("cartPanel").classList.remove('open');
  document.getElementById("checkoutForm").style.display = "none";
  document.getElementById("checkoutSuccess").style.display = "none";
}
// --------- CHECKOUT -----------
function showCheckout() {
  document.getElementById("checkoutForm").style.display = "block";
  document.getElementById("checkoutSuccess").style.display = "none";
}
document.getElementById("checkoutForm").onsubmit = function(e) {
  e.preventDefault();
  const order = {
    name: document.getElementById("checkoutName").value,
    address: document.getElementById("checkoutAddress").value,
    payment: document.getElementById("checkoutPayment").value,
    books: cart,
    price: cart.reduce((a, b) => a + b.price * b.qty, 0)
  };
  fetch("/checkout", {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify(order),
  })
  .then(res => res.json())
  .then(() => {
    document.getElementById("checkoutForm").style.display = "none";
    document.getElementById("checkoutSuccess").style.display = "block";
    cart = [];
    localStorage.setItem("cart", "[]");
    renderCart();
    confettiBurst();
    setTimeout(hideCart, 1600);
    addToPurchased(order.books);
  });
};

function addToPurchased(books) {
  let purchased = JSON.parse(localStorage.getItem("purchased") || "[]");
  books.forEach(b => {
    if (!purchased.find(x => x.id === b.id)) purchased.push(b);
  });
  localStorage.setItem("purchased", JSON.stringify(purchased));
}

// ------------ CONFETTI -----------
function showConfetti(cnt=12) {
  confettiBurst(cnt);
}
function confettiBurst(count=30) {
  const canvas = document.getElementById('confetti');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  canvas.style.display = "block";
  let ctx = canvas.getContext('2d'), w=canvas.width, h=canvas.height;
  let pieces = [];
  for (let i = 0; i < count; i++) {
    pieces.push({x:Math.random()*w, y:-30, r:8+Math.random()*6,
      c:`hsl(${Math.random()*360},95%,60%)`,
      vy:2+Math.random()*5, vx:(Math.random()-.5)*4, g:Math.random()*1.2
    });
  }
  let t = 0;
  function draw() {
    ctx.clearRect(0,0,w,h);
    for (let p of pieces) {
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fillStyle = p.c; ctx.globalAlpha = 0.92;
      ctx.fill();
      ctx.globalAlpha = 1;
      p.x += p.vx; p.y += p.vy+Math.sin(t/8+p.x/70)*3;
      p.vy += 0.13+p.g*0.14;
    }
    t+=1.6;
    if (pieces.some(p => p.y < h+40)) requestAnimationFrame(draw);
    else canvas.style.display = "none";
  }
  draw();
}
// --------- VIRTUAL BOOKSHELF --------
function addToBookshelf(bookId) {
  const bk = BOOKS.find(b => b.id === bookId);
  if (!bookshelf.find(x => x.id === bk.id)) bookshelf.push(bk);
  localStorage.setItem("bookshelf", JSON.stringify(bookshelf));
  renderBookshelf();
  showModal("Book added to your shelf! ðŸ“š");
}
function renderBookshelf() {
  const shelf = document.getElementById("bookshelfCarousel");
  if (!bookshelf.length) {
    shelf.innerHTML = "<div style='padding:2rem 0;color:var(--accent);'>No books in shelf.</div>";
    return;
  }
  shelf.innerHTML = bookshelf.map(book => `
    <div class="shelf-book-card">
      <img class="shelf-cover" src="${book.image}" />
      <div class="shelf-title">${book.title}</div>
      <div style="font-size:.96rem;color:#ffe082;margin-bottom:8px;">&#11088; ${book.rating}</div>
    </div>
  `).join("");
}
// ----------- QUOTE COLLECTOR -----------
function showQuoteModal(bookId) {
  let book = BOOKS.find(b => b.id === bookId);
  showModal(`<div>
    <div style='font-weight:bold; color:var(--accent);margin-bottom:.7rem;'>Add Favorite Quote for<br>"${book.title}"</div>
    <textarea id='favQuoteText' rows=3 style='width:93%;font-size:1.1rem;'></textarea>
    <button onclick='saveQuote(${bookId})' style='margin-top:1.2rem;padding:.48rem 1.2rem;border-radius:1.1rem;background:linear-gradient(91deg, var(--accent), #8cacf2, #ffee93);color:#fff;font-weight:bold;border:none;cursor:pointer;'>Save Quote</button>
  </div>`);
}
function saveQuote(bookId) {
  const text = document.getElementById('favQuoteText').value.trim();
  if (!text) return showModal("Please enter a quote!");
  let book = BOOKS.find(b => b.id === bookId);
  quotes.unshift({ book: book.title, author: book.author, quote: text, id:Date.now() });
  localStorage.setItem("quotes", JSON.stringify(quotes));
  renderQuotes();
  closeModal();
}
function renderQuotes() {
  const list = document.getElementById("quotesList");
  if (!quotes.length) {
    list.innerHTML = "<div style='padding:1.4rem;text-align:center;'>No saved quotes yet.</div>";
    return;
  }
  list.innerHTML = quotes.slice(0, 6).map(q =>
    `<li>"${q.quote}" â€“ <strong>${q.book}</strong> <span style="font-size:.96rem;color:#888;font-weight:400;font-style:italic;">by ${q.author}</span></li>`
  ).join("");
}

// ----------- READING PROGRESS -------------
function markReading(bookId) {
  let step = 20 + Math.floor(Math.random() * 80); // random progress for demo
  let ent = progressTracker.find(x => x.id === bookId);
  if (ent) ent.progress = Math.min(100, ent.progress + step);
  else progressTracker.push({ id: bookId, progress: step });
  localStorage.setItem("progress", JSON.stringify(progressTracker));
  renderReadingProgress();
  showModal("Reading progress updated!");
}
function renderReadingProgress() {
  let list = document.getElementById("progressList");
  if (!progressTracker.length) {
    list.innerHTML = "<div style='padding:1.2rem;text-align:center;'>No books marked as reading.</div>";
    return;
  }
  let html = "";
  progressTracker.forEach(rec => {
    let book = BOOKS.find(b => b.id === rec.id) || bookshelf.find(b=>b.id===rec.id);
    if (!book) return;
    html += `<div style="margin:1.1rem 0;display:flex;align-items:center;gap:1.1rem;flex-wrap:wrap;">
      <img src="${book.image}" style="width:39px;height:53px;border-radius:.4rem;object-fit:cover;"/>
      <div>
        <div style="font-weight:bold;color:var(--accent);">${book.title}</div>
        <div class="progress-bar-ct">
          <div class="progress-bar" style="width:${rec.progress}%"></div>
        </div>
        <div style="font-size:.95rem;opacity:.8;">Progress: ${rec.progress}%</div>
      </div>
    </div>`;
  });
  list.innerHTML = html;
}

// -------- MODAL ----------
function showModal(html) {
  let modalEl = document.getElementById("modal");
  document.getElementById('modalContent').innerHTML = html;
  modalEl.classList.add('open');
}
function closeModal() {
  document.getElementById("modal").classList.remove('open');
}
// -------- PROFILE -------------
function renderProfile() {
  document.getElementById("profileUsername").innerText = username;
  let purchased = JSON.parse(localStorage.getItem("purchased") || "[]");
  document.getElementById("profileBooks").innerHTML = !purchased.length
    ? "<div style='color:#abb;'>No purchased books yet.</div>"
    : purchased.slice(0,3).map(b => `<img src="${b.image}" title="${b.title}" />`).join("");
  document.getElementById("profileQuotes").innerHTML = !quotes.length ?
    "<div style='color:#abb;'>No saved quotes yet.</div>" :
    quotes.slice(0,2).map(q => `<div style="margin-bottom:.7rem;"><strong>${q.book}</strong> â€“ "${q.quote}"</div>`).join("");
  document.getElementById("profileReading").innerHTML = !progressTracker.length ?
    "<div style='color:#abb;'>No books marked as reading.</div>" :
    progressTracker.slice(0,2).map(r => {
      let book = BOOKS.find(b => b.id === r.id) || bookshelf.find(x => x.id === r.id);
      if (!book) return '';
      return `<div>
        <div style="font-weight:bold;">${book.title}</div>
        <div class="progress-bar-ct" style="margin-bottom:.7rem;">
          <div class="progress-bar" style="width:${r.progress}%"></div>
        </div>
        <div style="font-size:.95rem;opacity:.8;">Progress: ${r.progress}%</div>
      </div>`;
    }).join("");
}
function editProfile() {
  let val = prompt("Enter new username:", username);
  if (val && val.trim() && val.length < 30) {
    username = val.trim();
    localStorage.setItem("username", username);
    renderProfile();
    showModal("Username updated.");
  }
}

// --------- BOOK SWAP ---------
function postSwap(e) {
  e.preventDefault();
  const data = {
    title: document.getElementById('swapBookTitle').value,
    username: document.getElementById('swapUsername').value || "Anon",
    details: document.getElementById('swapDetails').value,
  };
  fetch('/swap', {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify(data)
  }).then(res => res.json())
  .then(() => {
    fetchSwaps();
    showModal("ðŸ“– Swap offer posted!");
    document.getElementById('swapForm').reset();
  });
}
function fetchSwaps() {
  fetch('/swaps')
    .then(res => res.json())
    .then(list => {
      let ul = document.getElementById('swapList');
      if (!list.length) { ul.innerHTML = "<div style='padding:1.2rem;color:#866;'>No swaps posted yet.</div>"; return; }
      ul.innerHTML = list.slice(-5).reverse().map(x=>`<li>${x.title}
        <span class="swap-user">@${x.username || 'Anon'}</span>
        <div style="font-size:.90rem;color:#989;">${x.details || ""}</div></li>`).join("");
    });
}
</script>
</body>
</html>
